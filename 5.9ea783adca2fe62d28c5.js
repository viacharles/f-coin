(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{D7sm:function(e,t,n){"use strict";n.r(t),n.d(t,"ChatModule",function(){return E});var s=n("ofXK"),i=n("tyNb"),o=n("IzEk"),r=n("pLZG"),a=n("zx2A");class c{constructor(e){this.notifier=e}call(e,t){const n=new d(e),s=Object(a.c)(this.notifier,new a.a(n));return s&&!n.seenValue?(n.add(s),t.subscribe(n)):n}}class d extends a.b{constructor(e){super(e),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}var l=n("lJxs"),h=function(e){return e[e.FetchChatHistory=1]="FetchChatHistory",e[e.SendMessage=2]="SendMessage",e}({}),u=n("SlXt"),f=n("itXk"),b=n("fXoL"),g=n("0tOT"),p=n("PvES"),m=n("DZuR"),y=n("Jgta"),M=n("a/YC"),v=n("N+D2");let w=(()=>{class e extends m.a{constructor(e,t,n){super(e,t),this.$overlay=n,this.databaseName="messageCenter"}fetchMessageRecord(e,t){const n=this.$overlay.startLoading(),s=document.activeElement;return s.blur(),new Promise(i=>{this.$fb.getDoc("messageCenter",e).collection("history").get().subscribe(e=>{this.$overlay.endLoading(n,s),i(e.docs.map(e=>e.data()).filter(({userId:e})=>e===t))})})}send(e,t,n){const s=this.$overlay.startLoading(),i=document.activeElement;return i.blur(),new Promise(o=>{this.$fb.getDoc("messageCenter",e).collection("history").add({message:t,isRead:!1,userId:n,sendTime:y.a.firestore.Timestamp.now()}).then(t=>{this.$logger.systemMessage(`message ${t.id} has successfully created.`),this.$fb.getDoc("messageCenter",e).collection("history").doc(t.id).update({id:t.id}).then(()=>{this.$overlay.endLoading(s,i),o(!0)})})})}}return e.\u0275fac=function(t){return new(t||e)(b.Rb(M.a),b.Rb(p.a),b.Rb(v.a))},e.\u0275prov=b.Eb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),C=(()=>{class e extends g.a{constructor(e,t){super(e),this.$message=t,this.featureName="Chat"}resolveAction({action:e,id:t,friendId:n,message:s}){return new Promise(i=>{switch(e){case h.FetchChatHistory:this.$message.fetchMessageRecord(t,n).then(e=>{this.$logger.systemMessage(`Total ${e.length} messages with friend ${n} has successfully fetched.`),i(e)});break;case h.SendMessage:i(this.$message.send(t,s,n))}})}}return e.\u0275fac=function(t){return new(t||e)(b.Rb(p.a),b.Rb(w))},e.\u0275prov=b.Eb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var x=n("LJo4"),O=n("3Pt+");let $=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=b.Cb({type:e,selectors:[["app-chat-announcement"]],decls:2,vars:0,template:function(e,t){1&e&&(b.Nb(0,"p"),b.lc(1,"chat-announcement works!"),b.Mb())},styles:["[_nghost-%COMP%]{display:block}"]}),e})();function I(e,t){1&e&&b.Jb(0,"app-chat-announcement")}function P(e,t){if(1&e&&(b.Nb(0,"section"),b.lc(1," 123\n"),b.Mb()),2&e){b.Xb();const e=b.ec(1),t=b.ec(14);b.ic("height","calc(100% - "+e.clientHeight+"px - "+t.clientHeight+"px)")}}function N(e,t){1&e&&(b.Nb(0,"section",10),b.Nb(1,"span",2),b.lc(2," question_answer "),b.Mb(),b.Mb())}const _=[{path:":id",component:(()=>{class e extends u.a{constructor(e,t,n){super(),this.$feature=e,this.$user=t,this.activatedRoute=n,this.message="",this.history=[],this.friend=null,this.userId=null}ngOnInit(){var e;this.$user.user$.pipe(Object(o.a)(1)).subscribe(e=>this.userId=e.id),Object(f.a)([this.$user.friends$.pipe(Object(r.a)(e=>e.length>0)),this.activatedRoute.params]).pipe((e=this.onDestroy$,t=>t.lift(new c(e))),Object(l.a)(([e,{id:t}])=>({friends:e,id:t}))).subscribe(({id:e,friends:t})=>this.initial(e,t))}afterKeydown(e){var t;"Enter"===e.key&&this.$feature.fireEvent({action:h.SendMessage,id:this.userId,message:this.message,friendId:null===(t=this.friend)||void 0===t?void 0:t.id}).then(()=>this.message="")}initial(e,t){this.friend=t.find(({id:t})=>t===e),this.$feature.fireEvent({action:h.FetchChatHistory,friendId:e,id:this.userId}).then(e=>this.history=e)}}return e.\u0275fac=function(t){return new(t||e)(b.Ib(C),b.Ib(x.a),b.Ib(i.a))},e.\u0275cmp=b.Cb({type:e,selectors:[["app-chat"]],features:[b.vb],decls:24,vars:5,consts:[[1,"w-100"],["tHeader",""],[1,"material-icons"],[4,"ngIf"],[3,"height",4,"ngIf","ngIfElse"],["tFooter",""],["placeholder","\u8acb\u8f38\u5165\u8a0a\u606f",1,"p-0",3,"ngModel","ngModelChange","keydown"],[1,"d-flex","flex-row","align-itmes-center"],["rotate45","",1,"material-icons"],["empty",""],[1,"d-flex","justify-content-center","align-item-center"]],template:function(e,t){if(1&e&&(b.Nb(0,"header",0,1),b.Nb(2,"nav"),b.Nb(3,"h3"),b.lc(4),b.Mb(),b.Jb(5,"em"),b.Mb(),b.Nb(6,"nav"),b.Nb(7,"em",2),b.lc(8,"search"),b.Mb(),b.Nb(9,"em",2),b.lc(10,"content_paste"),b.Mb(),b.Mb(),b.jc(11,I,1,0,"app-chat-announcement",3),b.Mb(),b.jc(12,P,2,2,"section",4),b.Nb(13,"footer",null,5),b.Nb(15,"textarea",6),b.Ub("ngModelChange",function(e){return t.message=e})("keydown",function(e){return t.afterKeydown(e)}),b.Mb(),b.Nb(16,"nav"),b.Nb(17,"div",7),b.Nb(18,"em",8),b.lc(19,"attach_file"),b.Mb(),b.Nb(20,"em",2),b.lc(21,"bookmark_border"),b.Mb(),b.Mb(),b.Mb(),b.Mb(),b.jc(22,N,3,0,"ng-template",null,9,b.kc)),2&e){const e=b.ec(23);b.yb(4),b.mc(null==t.friend?null:t.friend.name),b.yb(7),b.ac("ngIf",!1),b.yb(1),b.ac("ngIf",t.friend)("ngIfElse",e),b.yb(3),b.ac("ngModel",t.message)}},directives:[s.k,O.a,O.g,O.i,$],styles:["[_nghost-%COMP%]{display:block;height:100%}header[_ngcontent-%COMP%], nav[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}header[_ngcontent-%COMP%]{justify-content:space-between;height:50px;padding:0 .5rem;position:relative}header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-right:.5rem;font-size:.875rem}app-chat-announcement[_ngcontent-%COMP%]{width:100%;position:absolute;top:50px;left:0;height:40px}section[_ngcontent-%COMP%]{overflow-y:auto}footer[_ngcontent-%COMP%]{border-top:1px solid #f5f5f5;padding:.9rem 1rem 0}footer[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{outline:none;display:block;width:100%;min-height:80px;max-height:140px;border:none;resize:none;font-size:.75rem}footer[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:rgba(0,0,0,.2);font-size:.75rem}footer[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]{height:50px;padding:0 0 5px;display:flex;flex-direction:row;width:100%;justify-content:space-between}.material-icons.content-empty[_ngcontent-%COMP%]{font-size:60px;color:#b9c6d8}"]}),e})()}];let k=(()=>{class e{}return e.\u0275mod=b.Gb({type:e}),e.\u0275inj=b.Fb({factory:function(t){return new(t||e)},imports:[[i.e.forChild(_)],i.e]}),e})();var j=n("FpXt");let E=(()=>{class e{}return e.\u0275mod=b.Gb({type:e}),e.\u0275inj=b.Fb({factory:function(t){return new(t||e)},imports:[[j.a,s.c,k]]}),e})()}}]);